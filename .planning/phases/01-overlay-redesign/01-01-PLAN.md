---
phase: 01-overlay-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/overlay/RecordingOverlay.tsx
  - src/index.css
autonomous: true

must_haves:
  truths:
    - "Overlay appears as a floating pill shape (rounded ends)"
    - "Overlay is 48px tall with 24px border-radius and 240px min-width (pill proportions)"
    - "Overlay uses dark minimal theme (dark background, subtle border)"
    - "Recording state shows pulsing mic icon and audio level bars"
    - "Transcribing/Ghostwriting states show animated text"
    - "Cancel button is visible and responds to hover/click"
    - "ESC key cancels recording"
  artifacts:
    - path: "src/overlay/RecordingOverlay.tsx"
      provides: "WisprFlow-style overlay component"
      contains: "border-radius.*pill|rounded-full"
    - path: "src/index.css"
      provides: "Dark minimal pill styling"
      contains: "border-radius: 24px"
  key_links:
    - from: "src/overlay/RecordingOverlay.tsx"
      to: "Tauri events"
      via: "listen() for show-overlay, hide-overlay, mic-level"
      pattern: "listen.*show-overlay|hide-overlay|mic-level"
---

<objective>
Redesign the recording overlay frontend to match WisprFlow-style minimal floating pill design with dark theme and enhanced animations.

Purpose: Transform the overlay from functional-but-basic to polished WisprFlow aesthetic that feels invisible and instant.
Output: Updated RecordingOverlay.tsx component and index.css styling with pill shape, dark theme, and smooth animations.
</objective>

<execution_context>
@C:\Users\hsbaz\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\hsbaz\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-overlay-redesign/01-RESEARCH.md
@src/overlay/RecordingOverlay.tsx
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update overlay CSS to WisprFlow-style dark pill design</name>
  <files>src/index.css</files>
  <action>
Update the .recording-overlay class and related styles in src/index.css:

1. Change shape to pill (rounded ends):
   - Set `border-radius: 24px` (half of height for pill shape)
   - Increase height to 48px for better visual presence
   - Set min-width to 240px, max-width to 600px

2. Apply dark minimal theme:
   - Background: `oklch(0.12 0 0)` (very dark, near black)
   - Border: `1px solid oklch(0.25 0 0)` (subtle dark border, not harsh)
   - Remove the current harsh box-shadow, use soft elevated shadow: `0 8px 24px oklch(0 0 0 / 0.6)`
   - Add `backdrop-filter: blur(10px)` for modern glass effect

3. Update .bar styles for audio visualizer:
   - Use gradient from primary to accent: `linear-gradient(to top, var(--primary), var(--accent))`
   - Set width to 4px, border-radius to 2px for softer look
   - Increase max-height to 24px

4. Update state-specific styles:
   - .overlay-state-recording: Add subtle pulse glow around the pill
   - .overlay-state-transcribing: Keep current but match dark theme
   - .overlay-state-ghostwriting: Keep gradient animation but on dark background
   - .overlay-state-error: Red tint but maintain dark theme

5. Add prefers-reduced-motion support:
   - Disable animations for users who prefer reduced motion

IMPORTANT: Keep the existing grid layout structure (left/middle/right). Only change visual appearance.
  </action>
  <verify>
Open src/index.css and confirm:
- .recording-overlay has border-radius: 24px
- .recording-overlay has height: 48px, min-width: 240px (pill proportions)
- Background uses dark oklch value (oklch(0.12 0 0) or similar)
- Border is subtle (1px, dark color)
- @media (prefers-reduced-motion: reduce) rule exists with animation disabling
  </verify>
  <done>
CSS defines WisprFlow-style dark pill appearance with soft shadows, gradient audio bars, and reduced motion support.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update RecordingOverlay component animations and structure</name>
  <files>src/overlay/RecordingOverlay.tsx</files>
  <action>
Update src/overlay/RecordingOverlay.tsx to enhance animations while preserving event-driven architecture:

1. Improve entry/exit animations:
   - Wrap component in AnimatePresence for proper exit animations
   - Entry: scale from 0.9 to 1, opacity from 0 to 1
   - Exit: scale to 0.9, opacity to 0
   - Use spring transition: stiffness 400, damping 30
   - Keep duration under 300ms

2. Enhance recording state pulsing:
   - Add a pulsing glow ring behind the mic icon (CSS pseudo-element or extra motion.div)
   - Mic icon pulse: scale [1, 1.08, 1] with 1.2s duration (subtler than current 1.1)
   - Glow ring: scale [1, 1.3, 1], opacity [0.4, 0, 0.4] with 2s duration

3. Improve audio bars animation:
   - Keep existing spring physics (stiffness 400, damping 20)
   - Reduce number of bars from 9 to 7 for cleaner look
   - Keep power curve height calculation (Math.pow(v, 0.7))

4. Add state transition animations:
   - Use AnimatePresence mode="wait" for transcribing/ghostwriting text
   - Text slides up and fades in (y: 10 -> 0, opacity: 0 -> 1)
   - Text slides up and fades out on exit (y: 0 -> -10, opacity: 1 -> 0)

5. Update cancel button:
   - Add subtle hover glow effect
   - Keep whileHover scale: 1.1, whileTap scale: 0.95
   - Ensure title="Cancel (ESC)" is present for accessibility

CRITICAL: Do NOT change the event listening logic. Keep all listen() calls for show-overlay, hide-overlay, mic-level, ghostwriter-* events exactly as they are. Only modify visual/animation code.
  </action>
  <verify>
Run `bun run tauri dev` and trigger a recording:
1. Overlay should appear with smooth scale+fade animation (entry)
2. Mic icon should pulse gently during recording
3. Audio bars should animate with audio input
4. Press ESC during recording - confirm overlay scales down + fades out smoothly (exit animation under 300ms)
5. Cancel button shows title="Cancel (ESC)" on hover
  </verify>
  <done>
RecordingOverlay.tsx has enhanced Framer Motion animations for entry/exit, pulsing mic, and state transitions while preserving all event-driven state management.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `bun run tauri dev` starts without errors
2. Trigger recording with shortcut
3. Overlay appears as dark floating pill shape
4. Pulsing mic icon and audio bars visible during recording
5. ESC cancels recording, overlay fades out
6. No TypeScript compilation errors
</verification>

<success_criteria>
- Overlay visually matches WisprFlow-style: dark pill with soft shadow, not harsh borders
- Entry animation: smooth scale+fade under 300ms
- Recording shows pulsing mic and 7 animated audio bars
- Exit animation: smooth fade out
- ESC cancellation still works
- No runtime errors in console
</success_criteria>

<output>
After completion, create `.planning/phases/01-overlay-redesign/01-01-SUMMARY.md`
</output>
