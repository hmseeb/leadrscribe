---
phase: 10-security-code-health
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src-tauri/src/managers/streaming_buffer.rs
  - src-tauri/src/commands/streaming.rs
  - src-tauri/src/lib.rs
  - src-tauri/src/ghostwriter.rs
autonomous: true

must_haves:
  truths:
    - StreamingBuffer struct no longer exists in codebase
    - StreamingSession struct no longer managed in Tauri state
    - Ghostwriter streaming types removed (StreamResponse, StreamChoice, Delta)
    - process_text_streaming function removed from ghostwriter
    - No dead code warnings for streaming-related code
  artifacts:
    - path: src-tauri/src/managers/streaming_buffer.rs
      provides: DELETED (dead code removed)
      exists: false
    - path: src-tauri/src/commands/streaming.rs
      provides: Only StreamingTranscriptionEvent (keep), StreamingSession removed
      min_lines: 10
      exports: ["StreamingTranscriptionEvent"]
    - path: src-tauri/src/lib.rs
      provides: StreamingSession removed from managed state
      not_contains: "StreamingSession::new()"
    - path: src-tauri/src/ghostwriter.rs
      provides: Only non-streaming types remain
      not_contains: "process_text_streaming"
  key_links:
    - from: src-tauri/src/actions.rs
      to: StreamingTranscriptionEvent
      via: STREAMING_STATE emits partial/final events
      pattern: 'StreamingTranscriptionEvent::(Partial|Final)'
---

<objective>
Remove dead streaming architecture code (StreamingBuffer, StreamingSession, ghostwriter streaming types) replaced by STREAMING_STATE in actions.rs.

Purpose: Address 2 code health audit findings (HLTH-01, HLTH-02) that clutter codebase with unused code marked `#[allow(dead_code)]`
Output: Clean codebase with only active streaming implementation (STREAMING_STATE) and no dead code warnings
</objective>

<execution_context>
@C:/Users/hsbaz/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/hsbaz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:/Users/hsbaz/leadrscribe/.planning/PROJECT.md
@C:/Users/hsbaz/leadrscribe/.planning/ROADMAP.md
@C:/Users/hsbaz/leadrscribe/.planning/STATE.md
@C:/Users/hsbaz/leadrscribe/.planning/codebase/ARCHITECTURE.md

@C:/Users/hsbaz/leadrscribe/src-tauri/src/managers/streaming_buffer.rs
@C:/Users/hsbaz/leadrscribe/src-tauri/src/commands/streaming.rs
@C:/Users/hsbaz/leadrscribe/src-tauri/src/lib.rs
@C:/Users/hsbaz/leadrscribe/src-tauri/src/ghostwriter.rs
@C:/Users/hsbaz/leadrscribe/src-tauri/src/actions.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove dead StreamingBuffer and StreamingSession code</name>
  <files>src-tauri/src/managers/streaming_buffer.rs, src-tauri/src/commands/streaming.rs, src-tauri/src/lib.rs</files>
  <action>
**Delete entire streaming_buffer.rs file:**
```bash
rm src-tauri/src/managers/streaming_buffer.rs
```

**Update commands/streaming.rs:**
Remove the `StreamingSession` struct (lines 13-29) but KEEP `StreamingTranscriptionEvent` enum (lines 5-11).

Result should be:
```rust
use serde::Serialize;

#[derive(Clone, Serialize)]
#[serde(tag = "type")]
pub enum StreamingTranscriptionEvent {
    Partial { text: String, chunk_index: usize },
    Final { text: String },
    Error { message: String },
}
```

Remove the `use crate::managers::streaming_buffer::StreamingBuffer;` import at line 1.

**Update lib.rs:**
Remove line 93:
```rust
app_handle.manage(Arc::new(StreamingSession::new()));
```

Remove import for StreamingSession from commands module (find and remove):
```rust
use crate::commands::streaming::StreamingSession;
```

**Rationale:** StreamingBuffer and StreamingSession were the old streaming architecture using 2.5s chunks with 300ms overlap. This was replaced by STREAMING_STATE in actions.rs which manages streaming state differently. StreamingTranscriptionEvent is STILL USED by STREAMING_STATE to emit events, so it must be kept.

**Verification of what's still used:**
- Check actions.rs for `STREAMING_STATE` - this is the NEW streaming implementation
- Check actions.rs for `StreamingTranscriptionEvent` - confirms it's still used
- StreamingBuffer and StreamingSession are NOT referenced anywhere except their definitions
  </action>
  <verify>
Run `cargo build` - must compile successfully.
File `src-tauri/src/managers/streaming_buffer.rs` must not exist.
Grep for `StreamingSession` in src-tauri/src - should find ZERO matches.
Grep for `StreamingTranscriptionEvent` in src-tauri/src - should find matches (still used).
  </verify>
  <done>
StreamingBuffer struct deleted (entire file removed).
StreamingSession struct removed from commands/streaming.rs and lib.rs.
StreamingTranscriptionEvent enum preserved (still used by STREAMING_STATE).
No compilation errors from removed code.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove dead ghostwriter streaming types and function</name>
  <files>src-tauri/src/ghostwriter.rs</files>
  <action>
**Remove streaming types (lines 34-76):**

Delete these structs marked with `#[allow(dead_code)]`:
- `StreamResponse` struct (lines ~34-43)
- `StreamChoice` struct (lines ~45-52)
- `Delta` struct (lines ~54-60)

All three have `#[allow(dead_code)]` attribute indicating they're unused.

**Remove streaming function (line 242 onwards):**

Delete the `process_text_streaming` function entirely. It's marked `#[allow(dead_code)]` and is not called anywhere.

Function signature starts with:
```rust
#[allow(dead_code)]
async fn process_text_streaming(
```

**Keep the non-streaming types:**
- `NonStreamingResponse` struct
- `NonStreamingChoice` struct
- `Message` struct
- `process_text` function (the actual working implementation)

**Rationale:** The ghostwriter feature uses `process_text()` which makes a non-streaming API call to OpenRouter. The streaming types and `process_text_streaming()` function were experimental and never integrated. All are marked `#[allow(dead_code)]` confirming they're unused.

**Verification approach:**
After deletion, grep codebase for:
- `StreamResponse` - should find ZERO matches
- `process_text_streaming` - should find ZERO matches
- `process_text` (without "streaming") - should still find matches (it's used)
  </action>
  <verify>
Run `cargo build` - must compile successfully.
Grep for `StreamResponse` in src-tauri/src/ghostwriter.rs - should find ZERO matches.
Grep for `process_text_streaming` in src-tauri/src/ghostwriter.rs - should find ZERO matches.
Grep for `process_text` (exact, not streaming variant) in ghostwriter.rs - should find matches.
No `#[allow(dead_code)]` attributes should remain in ghostwriter.rs.
  </verify>
  <done>
StreamResponse, StreamChoice, Delta structs removed from ghostwriter.rs.
process_text_streaming function removed.
Non-streaming implementation (process_text) preserved and functional.
No dead code warnings for ghostwriter streaming code.
  </done>
</task>

</tasks>

<verification>
**Build verification:**
- `cd src-tauri && cargo build` - compiles successfully with NO dead code warnings for streaming

**File deletion verification:**
- `ls src-tauri/src/managers/streaming_buffer.rs` - file not found (404)

**Code removal verification:**
- `grep -r "StreamingBuffer" src-tauri/src/` - ZERO matches (struct deleted)
- `grep -r "StreamingSession" src-tauri/src/` - ZERO matches (struct deleted)
- `grep -r "StreamResponse" src-tauri/src/` - ZERO matches (ghostwriter type deleted)
- `grep -r "process_text_streaming" src-tauri/src/` - ZERO matches (function deleted)

**Active code preservation:**
- `grep -r "StreamingTranscriptionEvent" src-tauri/src/` - matches found (still used)
- `grep -r "STREAMING_STATE" src-tauri/src/actions.rs` - matches found (active implementation)
- `grep "process_text" src-tauri/src/ghostwriter.rs` - matches found (non-streaming version works)

**No regressions:**
- Streaming transcription display still works (uses STREAMING_STATE + StreamingTranscriptionEvent)
- Ghostwriter still works (uses process_text non-streaming)
</verification>

<success_criteria>
**Dead code removed:**
- StreamingBuffer struct and entire streaming_buffer.rs file deleted
- StreamingSession struct removed from lib.rs managed state
- Ghostwriter streaming types (StreamResponse, StreamChoice, Delta) removed
- process_text_streaming function removed

**Active code preserved:**
- StreamingTranscriptionEvent enum kept (used by STREAMING_STATE in actions.rs)
- process_text function kept (used by ghostwriter)
- STREAMING_STATE in actions.rs untouched (active implementation)

**All 2 code health audit findings (HLTH-01, HLTH-02) resolved:**
- ✅ HLTH-01: StreamingBuffer and StreamingSession removed
- ✅ HLTH-02: Ghostwriter streaming types and function removed

**Zero regressions:**
- Application compiles successfully
- No dead code warnings in cargo build output
- Streaming transcription display works (via STREAMING_STATE)
- Ghostwriter works (via process_text)
</success_criteria>

<output>
After completion, create `.planning/phases/10-security-code-health/10-02-SUMMARY.md` following the summary template format.
</output>
